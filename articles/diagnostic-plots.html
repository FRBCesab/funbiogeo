<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="funbiogeo">
<title>Diagnostic Plots in funbiogeo • funbiogeo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diagnostic Plots in funbiogeo">
<meta property="og:description" content="funbiogeo">
<meta property="og:image" content="https://frbcesab.github.io/funbiogeo/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">funbiogeo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/funbiogeo.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/diagnostic-plots.html">Diagnostic Plots in funbiogeo</a>
    <a class="dropdown-item" href="../articles/long-format.html">Formatting your data</a>
    <a class="dropdown-item" href="../articles/upscaling.html">Upscaling your data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/frbcesab/funbiogeo/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Diagnostic Plots in funbiogeo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/frbcesab/funbiogeo/blob/HEAD/vignettes/diagnostic-plots.Rmd" class="external-link"><code>vignettes/diagnostic-plots.Rmd</code></a></small>
      <div class="d-none name"><code>diagnostic-plots.Rmd</code></div>
    </div>

    
    
<p><code>funbiogeo</code> contains many plotting functions. They have
multiple goals: (1) propose good default plots to inspect and represent
your data, (2) provide easy plotting methods for complex objects
(automatically display maps from spatial objects), and (3) provide
plotting methods for computed functional diversity metrics in other
packages. This vignette explains in detail all plotting functions
available in <code>funbiogeo</code>, how to use them and how to
interpret them.</p>
<p>Some of these plotting functions use different data inputs and some
of them can deal with species categorization, i.e.  displaying
information by each category of species (family, order, endemism status,
etc.). We detail the standard needed inputs in the table below, the
“Additional input” column represents needed input that are not the other
standard tables specified by the other columns.</p>
<table class="table">
<caption>A table of available plotting functions in
<code>funbiogeo</code> ordered alphabetically with their required
arguments. The “Additional input” column reflects the need for other
argument that are not of the standard object type.</caption>
<colgroup>
<col width="35%">
<col width="12%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">Function name</th>
<th align="center">Site x species</th>
<th align="center">Species x traits</th>
<th align="center">Site x locations</th>
<th align="center">Species category</th>
<th align="center">Additional input</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="../reference/fb_plot_distribution_site_trait_coverage.html">fb_plot_distribution_site_trait_coverage()</a></code></td>
<td align="center">✅</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">❌</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/fb_plot_number_sites_by_species.html">fb_plot_number_sites_by_species()</a></code></td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">❌</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/fb_plot_number_species_by_trait.html">fb_plot_number_species_by_trait()</a></code></td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/fb_plot_number_traits_by_species.html">fb_plot_number_traits_by_species()</a></code></td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/fb_plot_site_environment.html">fb_plot_site_environment()</a></code></td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/fb_plot_site_traits_completeness.html">fb_plot_site_traits_completeness()</a></code></td>
<td align="center">✅</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/fb_plot_species_traits_completeness.html">fb_plot_species_traits_completeness()</a></code></td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/fb_plot_trait_combination_frequencies.html">fb_plot_trait_combination_frequencies()</a></code></td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/fb_plot_trait_correlation.html">fb_plot_trait_correlation()</a></code></td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/fb_map_raster.html">fb_map_raster()</a></code></td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/fb_map_site_data.html">fb_map_site_data()</a></code></td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/fb_map_site_traits_completeness.html">fb_map_site_traits_completeness()</a></code></td>
<td align="center">✅</td>
<td align="center">✅</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">❌</td>
</tr>
</tbody>
</table>
<p>Let’s first load the package and example datasets included in the
<code>funbiogeo</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/frbcesab/funbiogeo" class="external-link">"funbiogeo"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-spatial.github.io/sf/" class="external-link">"sf"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"site_locations"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"site_species"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"species_traits"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="naming-convention">Naming Convention<a class="anchor" aria-label="anchor" href="#naming-convention"></a>
</h2>
<p>Like in the rest of the <code>funbiogeo</code> package, the functions
are named following certain conventions. For one, to avoid any collision
with other packages all the functions are prefixed with
<code>fb_</code>. Second all plotting functions begin with either
<code>fb_plot_*()</code>, when they are regular plots, or
<code>fb_map_*()</code> when they plot maps.</p>
<p>The function names in <code>funbiogeo</code> are generally long to be
as specific and clear as possible. So in case of doubt re-read the
function name, and what it should represent should be clear from the
name.</p>
</div>
<div class="section level2">
<h2 id="regular-plots">Regular Plots<a class="anchor" aria-label="anchor" href="#regular-plots"></a>
</h2>
<p>In this section we will describe what we call “regular plots”, i.e.
plots of non-spatial objects (density plots, bivariate plots, lollipop
charts, heatmaps, etc.). We made this distinction because maps have
their own specific challenges. All the default regular plots proposed in
<code>funbiogeo</code> are quite specific to the data. In each of the
section below we’ll summarize what the plots is about, what are the
needed arguments, and how to interpret the output.</p>
<p>The function are all described in their specific subsections in
alphabetical order.</p>
<div class="section level3">
<h3 id="distribution-of-trait-coverages-across-sites">Distribution of trait coverages across sites<a class="anchor" aria-label="anchor" href="#distribution-of-trait-coverages-across-sites"></a>
</h3>
<p>Visualizing the trait coverage of all sites can help isolate which
traits may show consistently low coverage. Also this can help notice if
some groups of sites have higher coverage for certain traits than for
others.</p>
<p>You can plot this using the
<code><a href="../reference/fb_plot_distribution_site_trait_coverage.html">fb_plot_distribution_site_trait_coverage()</a></code> function. It
takes two arguments: <code>site_species</code> the site by species
<code>data.frame</code> and <code>species_traits</code> the species by
traits <code>data.frame</code>. Note that internally the function uses
<a href="https://cran.r-project.org/package=ggridges" class="external-link"><code>ggridges</code></a>
to plot the distributions. This package is thus needed to run this
function.</p>
<p>Example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_distribution_site_trait_coverage.html">fb_plot_distribution_site_trait_coverage</a></span><span class="op">(</span><span class="va">site_species</span>, <span class="va">species_traits</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: ggridges</span></span>
<span><span class="co">#&gt; Picking joint bandwidth of 0.00988</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-dist-site-cov-1.png" width="700"></p>
<p>We see the distribution of species coverage per site (along the
x-axis) for each trait (along the y-axis) and with all traits taken
together (shown at the top of the top on the line
<code>all_traits</code>). The proportions on the y-axis labels are the
average coverage observed for this trait. So for example, considering
only adult body mass as a trait would mean that we would achieve an
average coverage of 95.3%, meaning that on average across all sites
95.3% of species are covered. We can compare this to the trait
<em>max_longevity</em> which corresponds to the maximum longevity of the
species. We see that the average trait coverage across all sites is
82.1%. We see that the distribution however is rather wide, with some
sites showing a coverage of around 90% (the large bump), while some
sites are close to 62% coverage.</p>
<p>This plot considers the distribution of species across sites instead
of focusing only on the species by traits <code>data.frame</code>. This
maybe useful to realize, for example, that the traits of a species
occurring very rarely are missing this wouldn’t necessarily translate in
low site-level trait coverage.</p>
</div>
<div class="section level3">
<h3 id="plotting-the-number-of-sites-by-species">Plotting the number of sites by species<a class="anchor" aria-label="anchor" href="#plotting-the-number-of-sites-by-species"></a>
</h3>
<p>The function <code><a href="../reference/fb_plot_number_sites_by_species.html">fb_plot_number_sites_by_species()</a></code> allows to
explore the site by species <code>data.frame</code>. It shows the number
(and proportion) of sites occupied by each species. Its first argument
<code>site_species</code>, the site by species <code>data.frame</code>
is necessary while the second one
<code>threshold_sites_proportion</code>, a target proportion of sites
coverage, is optional.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_sites_by_species.html">fb_plot_number_sites_by_species</a></span><span class="op">(</span><span class="va">site_species</span><span class="op">)</span></span>
<span><span class="co">#&gt; There are more than 30 species, the y-axis will label the position of 30 evenly spaced species (along their prevalence)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-sites-coverage-species-1.png" width="700"></p>
<p>The function outputs a dotchart. The number of occupied sites per
species is indicated at the bottom x-axis, while the top x-axis
represents the proportion of occupied sites. The left y-axis label
species names (in parenthesis) and their rank by increasing prevalence.
Note that for readability constraints, only a limited number of species
are labeled on the y-axis, but they are all displayed as dots on the
plot.</p>
<p>Adding the second argument <code>threshold_sites_proportion</code>
displays a vertical bar at the target proportion of sites to see how
many species occupy more or less than the given proportion of sites.</p>
<p>Let’s say we want to see the species present in at least 40% of the
sites:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_sites_by_species.html">fb_plot_number_sites_by_species</a></span><span class="op">(</span><span class="va">site_species</span>, threshold_sites_proportion <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="co">#&gt; There are more than 30 species, the y-axis will label the position of 30 evenly spaced species (along their prevalence)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-sites-coverage-species-thresh-1.png" width="700"></p>
<p>The threshold bar helps us get a sense of how many species are
present in at least 40% of the sites. It also displays the corresponding
number of sites.</p>
</div>
<div class="section level3">
<h3 id="plotting-the-number-of-species-per-trait">Plotting the number of species per trait<a class="anchor" aria-label="anchor" href="#plotting-the-number-of-species-per-trait"></a>
</h3>
<p>One way to look at the species by traits <code>data.frame</code> is
to look at number of species with non-missing trait values for each
trait. The <code><a href="../reference/fb_plot_number_species_by_trait.html">fb_plot_number_species_by_trait()</a></code> function does
exactly that. Its first argument <code>species_traits</code>, the
species by traits <code>data.frame</code>, is necessary while the second
one <code>threshold_species_proportion</code>, a target proportion of
species coverage, is optional.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_species_by_trait.html">fb_plot_number_species_by_trait</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-species-coverage-trait-1.png" width="700"></p>
<p>The function outputs a lollipop chart. On the bottom x-axis there is
the number of species covered by the given trait (the top x-axis
represents the proportion of species, which is directly proportional).
The y-axis represents each trait. The dot represents the actual coverage
observed with the corresponding proportion of species written on top.
With this figure we see that 82.6% of the species have a non-missing
adult body mass in the species by trait <code>data.frame</code>, while
only 54.4% have a non-missing maximum longevity.</p>
<p>Adding the second argument <code>threshold_species_proportion</code>
displays a vertical bar at the target proportion to easily target traits
covering a certain proportion of species. Let’s say we want to see
traits available for at least 70% of the species:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_species_by_trait.html">fb_plot_number_species_by_trait</a></span><span class="op">(</span><span class="va">species_traits</span>, threshold_species_proportion <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-species-coverage-trait-thresh-1.png" width="700"></p>
<p>The red dashed vertical line shows the corresponding species coverage
with labels indicating the proportion and corresponding number of
species (n = 104).</p>
</div>
<div class="section level3">
<h3 id="plotting-the-number-of-traits-per-species">Plotting the number of traits per species<a class="anchor" aria-label="anchor" href="#plotting-the-number-of-traits-per-species"></a>
</h3>
<p>You can also display the number of traits available per species.
Showing it for each species would be quite difficult to read, so we
decided instead to represent the number of species having given number
of known traits. Also, because most trait ecologists are interested in
multiple traits, we considered nested proportions of traits: considering
the number of species covered by at least one trait, at least two,
etc.</p>
<p>To represent such a plot you can use the function
<code><a href="../reference/fb_plot_number_traits_by_species.html">fb_plot_number_traits_by_species()</a></code>, it uses two arguments.
The first <code>species_traits</code> is the species by traits
<code>data.frame</code>. The second argument is
<code>threshold_species_proportion</code> which is optional and
corresponds to a certain threshold proportion of species, so that a line
can be added to the plot.</p>
<p>Using it on the included dataset gives:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_traits_by_species.html">fb_plot_number_traits_by_species</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-n-traits-species-1.png" width="700"></p>
<p>The x-axis represents the number of species concerned (bottom x-axis
displays the actual number of species, while top x-axis displays the
corresponding proportion of species). The y-axis shows the number of
each traits. Note that the categories are nested: the set of species
with at least 1 trait contains the set of species with at least 2
traits, and so on and so forth. By definition all species have 0 or more
known traits, but we show that in the plot as a reference to see how the
proportion decreases with increasing number of traits. The proportion is
shown as text above each dot representing it. So for example, there are
62.4% species with at least 4 traits.</p>
<p>This plot does not tell us if all species with at least 4 traits
share the same trait combination (there are multiple 4 trait
combinations), but it’s a first indication.</p>
<p>Let’s say we’re interested in combinations of traits with at least
50% species covered. We can use the second argument to show it:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_traits_by_species.html">fb_plot_number_traits_by_species</a></span><span class="op">(</span><span class="va">species_traits</span>, threshold_species_proportion <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-n-traits-species-thresh-1.png" width="700"></p>
<p>Adding this argument displays a vertical bar at the target proportion
of species to easily target number of traits covering a certain
proportion of species. The red dashed vertical line shows the
corresponding species coverage with labels indicating the proportion and
corresponding number of species (n = 74).</p>
</div>
<div class="section level3">
<h3 id="plotting-environmental-position-of-sites">Plotting environmental position of sites<a class="anchor" aria-label="anchor" href="#plotting-environmental-position-of-sites"></a>
</h3>
<p>To see if our sites are biased environmentally it can be nice to
locate them along environmental variables compared to a full region. For
the sake of simplicity we can focus on two variables against which to
compare our sites to a region. That is what the
<code><a href="../reference/fb_plot_site_environment.html">fb_plot_site_environment()</a></code> function does. It has four
arguments: the first one, <code>site_locations</code>, provides the
locations of sites as an <code>sf</code> object,
<code>environment_raster</code> is a <a href="http://cran.r-project.org/package=terra" class="external-link"><code>terra</code></a>
raster object, the next two arguments are <code>first_layer</code> and
<code>second_layer</code> which are the names of the two variables to be
extracted from <code>environment_raster</code> to make our plot.</p>
<p>From the included dataset we can represent the first 6 sites along
total annual precipitation and mean annual temperature over the full
region:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the environmental rasters</span></span>
<span><span class="va">prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"annual_tot_prec.tif"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span><span class="op">)</span></span>
<span><span class="va">tavg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"annual_mean_temp.tif"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">layers</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tavg</span>, <span class="va">prec</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make plot (show environmental position of 6 first sites)</span></span>
<span><span class="fu"><a href="../reference/fb_plot_site_environment.html">fb_plot_site_environment</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_locations</span><span class="op">)</span>, <span class="va">layers</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 49503 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The plot shows the first selected layer as the x-axis and the second
one as the y-axis. The environmental position of the sites are displayed
using the big blue dots, while the light gray pixels are all the
environmental variables extracted from the provided environmental
raster.</p>
<p>This figure can show us that the first six sites are actually lower
in temperature and higher in annual precipitation than most other places
in our environmental rasters.</p>
</div>
<div class="section level3">
<h3 id="plotting-trait-coverage-for-all-sites">Plotting trait coverage for all sites<a class="anchor" aria-label="anchor" href="#plotting-trait-coverage-for-all-sites"></a>
</h3>
<p>To select appropriate sites and traits, we can visualize the trait
coverage per site and per trait. This is exactly what is done by
<code><a href="../reference/fb_plot_site_traits_completeness.html">fb_plot_site_traits_completeness()</a></code> which takes
<code>site_species</code>, the site by species <code>data.frame</code>,
and <code>species_traits</code>, the species by traits
<code>data.frame</code>, as arguments.</p>
<p>We can use it with the included dataset as an example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_site_traits_completeness.html">fb_plot_site_traits_completeness</a></span><span class="op">(</span><span class="va">site_species</span>, <span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-site-trait-complete-1.png" width="700"></p>
<p>The plot shows the trait along the x-axis (and their average coverage
across all sites in their labels) and sites along the y-axis. Each thin
horizontal line represents a site. The color indicates the coverage for
the trait in each column. Note that for readability reasons the color
scale has been discretized from 0 to 100% coverage. Traits are ranked in
decreasing average coverage. The last column <code>all_traits</code>
contains the coverage for all traits taken together.</p>
<p>With this figure we can see that all sites have over 80% coverage
with both adult body mass and litter size.</p>
</div>
<div class="section level3">
<h3 id="plotting-trait-coverage-per-species">Plotting trait coverage per species<a class="anchor" aria-label="anchor" href="#plotting-trait-coverage-per-species"></a>
</h3>
<p>To select appropriate traits, we can visualize the trait coverage per
species. This is done by
<code><a href="../reference/fb_plot_species_traits_completeness.html">fb_plot_species_traits_completeness()</a></code> which takes
<code>species_traits</code>, the species by traits
<code>data.frame</code>, for sole argument.</p>
<p>We can use it with the included dataset as an example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_species_traits_completeness.html">fb_plot_species_traits_completeness</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-species-trait-complete-1.png" width="700"></p>
<p>This figure visualizes directly the species by trait
<code>data.frame</code>. The x-axis displays the different traits,
ranked from left to right in decreasing coverage order (as indicated in
the x-axis labels). The last column <code>all_traits</code> considers
all traits taken together. The y-axis represents species in decreasing
coverage order from bottom to top. Each cell thus represents the trait
for a species: blue if the trait is known and red if it is missing.</p>
<p>From this plot we see that a significant proportion of species have
missing traits and that even the most non-missing traits, adult body
mass, is only known for 82.6% of the species.</p>
</div>
<div class="section level3">
<h3 id="displaying-traits-combinations">Displaying traits combinations<a class="anchor" aria-label="anchor" href="#displaying-traits-combinations"></a>
</h3>
<p>Looking at the traits coverage for each species continuously maybe
impractical or difficult. For example, when trying to display thousands
of species or when the trait coverage varies widely across species. One
way to reduce the size of the analyzed (and thus visualized) dataset is
instead to count at which frequency appear the combinations of
present/missing traits.</p>
<p>This is done by <code><a href="../reference/fb_plot_trait_combination_frequencies.html">fb_plot_trait_combination_frequencies()</a></code>
which takes two arguments: <code>species_traits</code>, the species by
traits <code>data.frame</code>, and <code>order_by</code> (equals to
either <code>"number"</code>, the default option, or
<code>"complete"</code>), which influences the order of the plot (more
details below).</p>
<p>We can use it with the included dataset as an example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_trait_combination_frequencies.html">fb_plot_trait_combination_frequencies</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-trait-comb-freq-1.png" width="700"></p>
<p>The x-axis represents individual traits ranked in alphabetical order
from left to right. The y-axis represents different combinations. The
labels on the y-axis show both the number and the frequency of each
combination. When the cell is blue it means that the trait is present,
when it is red it means the trait is missing. By default the
combinations are ordered by increasing number from top to bottom, with
the most numerous combinations of trait presences at the very bottom of
the graph.</p>
<p>With this graph we can see that we have exactly 53 species (35.6% of
the total number of species provided) have all their traits present,
while 21 species (14.1%) have not a single trait in the dataset.</p>
<p>If we change <code>order_by</code> to <code>"complete"</code>, the
combinations are ordered instead by the number of trait presents among
them:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_trait_combination_frequencies.html">fb_plot_trait_combination_frequencies</a></span><span class="op">(</span><span class="va">species_traits</span>, order_by <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-trait-comb-freq-order-1.png" width="700"></p>
<p>The most complete combinations are shown at the bottom, while the
combinations with most missing traits are at the top.</p>
</div>
<div class="section level3">
<h3 id="displaying-traits-correlations">Displaying traits correlations<a class="anchor" aria-label="anchor" href="#displaying-traits-correlations"></a>
</h3>
<p>Most of the plot functions in <code>funbiogeo</code> show traits
independently of one another. However, for functional biogeography
analyses, trait correlations maybe very relevant. This is exactly what
is done by <code><a href="../reference/fb_plot_trait_correlation.html">fb_plot_trait_correlation()</a></code>. It takes as first
needed argument <code>species_traits</code>, the species by traits
<code>data.frame</code>. The other arguments are optional and will be
passed to <code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">stats::cor()</a></code>.</p>
<p>Note that the function only works with <strong>numerical
traits</strong> and with <strong>complete observations</strong>. It
silently removes any species that has any <code>NA</code>.</p>
<p>With the included dataset as an example:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_trait_correlation.html">fb_plot_trait_correlation</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/plot-trait-corr-1.png" width="700"></p>
<p>Both x- and y-axes represent the different traits. At their
intersection are shown squared that are colored in function of their
correlation coefficient (purple means close to -1 correlation while
brown means close to 1, white means close to 0). The correlation
coefficients are also displayed in the middle of this square.</p>
<p>With this visualization we can see that adult body mass and gestation
length are quite highly correlated (cor = 0.7), while diet breadth is
correlated with no other trait.</p>
</div>
</div>
<div class="section level2">
<h2 id="maps">Maps<a class="anchor" aria-label="anchor" href="#maps"></a>
</h2>
<p>Map functions in <code>funbiogeo</code> are here to provide good
default visualization leveraging the spatial information of sites. We
know that producing map in R is challenging. That’s why we provide these
helper functions. Of course, these functions are all basics and you
either have to customize them by adding <code>ggplot2</code> commands to
the returned plots, or to look at their code to produce similar plots in
the way you want.</p>
<p>For example, the functions do not display background maps because it
would be too complex to accommodate for all use cases between quite
localized sites up to global level analyses.</p>
<p>Note that all maps are always in the Coordinate Reference System of
the provided <code>site_locations</code> object. You can also tweak that
by adding a custom <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">ggplot2::coord_sf()</a></code> call.</p>
<div class="section level3">
<h3 id="mapping-traits-coverage-of-sites">Mapping traits coverage of sites<a class="anchor" aria-label="anchor" href="#mapping-traits-coverage-of-sites"></a>
</h3>
<p>The function <code><a href="../reference/fb_map_site_traits_completeness.html">fb_map_site_traits_completeness()</a></code> maps the
trait coverage (proportion of species, weighted by relative abundance if
relevant, with known trait values) of each site for all traits.</p>
<p>It takes three arguments: <code>site_locations</code> (spatial
locations of sites), <code>site_species</code> (site by species
<code>data.frame</code>), and <code>species_traits</code> (species by
traits <code>data.frame</code>).</p>
<p>If we use the included dataset in <code>funbiogeo</code> it
gives:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_map_site_traits_completeness.html">fb_map_site_traits_completeness</a></span><span class="op">(</span><span class="va">site_locations</span>, <span class="va">site_species</span>, <span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/map-trait-complete-1.png" width="700"></p>
<p>It displays maps of the sites, colored by their trait coverage. Each
facet represents a different trait while the <code>all_traits</code>
facet consider all traits together.</p>
<p>From this plot we can see that on average the South of Western Europe
is less covered by traits than the North of Western Europe. It may be an
indication of higher species richness in the South compared to the North
which makes achieving high coverages more difficult. Furthermore, we can
see that a site in the Netherlands has 0% coverage of diet breadth. This
is most likely the sign of sign of low species richness with an absence
of diet breadth for those species.</p>
</div>
<div class="section level3">
<h3 id="mapping-arbitrary-site-data">Mapping arbitrary site data<a class="anchor" aria-label="anchor" href="#mapping-arbitrary-site-data"></a>
</h3>
<p>To be the most flexible possible, <code>funbiogeo</code> provides a
function to map arbitrary site data whether quantitative or qualitative
with the <code><a href="../reference/fb_map_site_data.html">fb_map_site_data()</a></code> function. The first argument it
takes is <code>site_locations</code>, the spatial locations of sites as
an <code>sf</code> object, the second argument is <code>site_data</code>
which is a <code>data.frame</code> containing a <code>"site"</code>
column and data in additional columns, the third and last required
argument is <code>selected_col</code> which should be the name of the
column provided in the <code>site_data</code> <code>data.frame</code>
that is going to be used as a variable to display. All three arguments
are required.</p>
<p>For example, if we want to get a map of species richness of the
included dataset we can do the following:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute Species Richness</span></span>
<span><span class="va">site_rich</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fb_count_species_by_site.html">fb_count_species_by_site</a></span><span class="op">(</span><span class="va">site_species</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Map of Species Richness</span></span>
<span><span class="fu"><a href="../reference/fb_map_site_data.html">fb_map_site_data</a></span><span class="op">(</span><span class="va">site_locations</span>, <span class="va">site_rich</span>, <span class="st">"n_species"</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/map-site-data-sr-1.png" width="700"></p>
<p>From this map, we can for example see that the Northern part of our
dataset is less species-rich than the center or the South.</p>
<p>Now imagine we want to display the category of sites which be
“Testing” or “Training”, depending on which set they belong to. We can
use the following to display the map:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate categories</span></span>
<span><span class="va">site_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  site <span class="op">=</span> <span class="va">site_species</span><span class="op">$</span><span class="va">site</span>,</span>
<span>  set  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Testing"</span>, <span class="st">"Training"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">site_species</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display them</span></span>
<span><span class="fu"><a href="../reference/fb_map_site_data.html">fb_map_site_data</a></span><span class="op">(</span><span class="va">site_locations</span>, <span class="va">site_cat</span>, <span class="st">"set"</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/map-site-data-cat-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="mapping-site-rasters">Mapping site rasters<a class="anchor" aria-label="anchor" href="#mapping-site-rasters"></a>
</h3>
<p>Mapping rasters can be quite cumbersome with R.
<code>funbiogeo</code> provides a generic function to map them with
<code><a href="../reference/fb_map_raster.html">fb_map_raster()</a></code>. It only needs as first argument a
<code>terra</code> <code>SpatRaster</code> object. It can be very useful
when visualizing environmental layers for example. The function will
display the raster in the provided projection.</p>
<p>For example:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Getting the raster</span></span>
<span><span class="va">tavg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"annual_mean_temp.tif"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span><span class="op">)</span></span>
<span><span class="va">tavg</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mapping the raster</span></span>
<span><span class="fu"><a href="../reference/fb_map_raster.html">fb_map_raster</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span></span></code></pre></div>
<p><img src="diagnostic-plots_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Nicolas Casajus, Matthias Grenié.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
