<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with funbiogeo • funbiogeo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get started with funbiogeo">
<meta property="og:description" content="funbiogeo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">funbiogeo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/funbiogeo.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/diagnostic-plots.html">Diagnostic Plots in funbiogeo</a>
    </li>
    <li>
      <a href="../articles/long-format.html">Formatting your data</a>
    </li>
    <li>
      <a href="../articles/upscaling.html">Upscaling Your Data with funbiogeo</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/frbcesab/funbiogeo/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started with funbiogeo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/frbcesab/funbiogeo/blob/HEAD/vignettes/funbiogeo.Rmd" class="external-link"><code>vignettes/funbiogeo.Rmd</code></a></small>
      <div class="hidden name"><code>funbiogeo.Rmd</code></div>

    </div>

    
    
<p>The aim of the <code>funbiogeo</code>package is to help users streamline the workflows in <strong>fun</strong>ctional <strong>biogeo</strong>graphy <span class="citation">(Violle et al. 2014)</span>. It helps filter sites, species, and traits based on their trait coverages. It also provide default diagnostic plots and standard tables summarizing input data. This vignette aims to be an introduction to the most commonly used functions.</p>
<p>The vignette will be a worked through a real world example using the internal dataset provided by <code>funbiogeo</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/frbcesab/funbiogeo" class="external-link">"funbiogeo"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="provided-data">Provided data<a class="anchor" aria-label="anchor" href="#provided-data"></a>
</h2>
<p>We are interested in mapping the functional traits of mammals of Europe. We used range maps data <a href="https://www.iucnredlist.org/resources/spatial-data-download" class="external-link">from the IUCN</a> and trait data from the <a href="https://esapubs.org/archive/ecol/E090/184/" class="external-link">PanTHERIA database</a> <span class="citation">(Jones et al. 2009)</span>. The initial extraction is available on <a href="https://github.com/FRBCesab/eumammals" class="external-link">GitHub</a>.</p>
<p>The package <code>funbiogeo</code> requires three different datasets to proceed with the analyses:</p>
<ul>
<li>the <strong>species x traits</strong> <code>data.frame</code> (<code>species_traits</code> in <code>funbiogeo</code>)</li>
<li>the <strong>site x species</strong> <code>data.frame</code> (<code>site_species</code> in <code>funbiogeo</code>)</li>
<li>the <strong>site x locations</strong> object (<code>site_locations</code> in <code>funbiogeo</code>)</li>
</ul>
<p>You can load the example data using <code>data(..., package = "funbiogeo")</code> call:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"site_species"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"site_locations"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"species_traits"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="species-x-traits">Species x Traits<a class="anchor" aria-label="anchor" href="#species-x-traits"></a>
</h3>
<p>This object contains traits values for studied species. It should be a <code>data.frame</code>. The first column should contain species names and the other columns contain trait values.</p>
<p>Note that we’ll be talking about <strong>species</strong> throughout this vignette and in the arguments of <code>funbiogeo</code>, but the package doesn’t make any assumption on the biological level. It can be individuals, populations, strains, species, genera, families, etc. The important fact is that you should have trait data for the level at which you want to work.</p>
<p>Let’s examine the <code>species_traits</code> data included in the package:</p>
<table class="table">
<caption>First lines of species x traits dataset</caption>
<colgroup>
<col width="8%">
<col width="16%">
<col width="17%">
<col width="12%">
<col width="14%">
<col width="20%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">species</th>
<th align="right">adult_body_mass</th>
<th align="right">gestation_length</th>
<th align="right">litter_size</th>
<th align="right">max_longevity</th>
<th align="right">sexual_maturity_age</th>
<th align="right">diet_breadth</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">sp_001</td>
<td align="right">461900.76</td>
<td align="right">235.00</td>
<td align="right">1.25</td>
<td align="right">324</td>
<td align="right">668.20</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">sp_002</td>
<td align="right">21.11</td>
<td align="right">19.89</td>
<td align="right">5.64</td>
<td align="right">48</td>
<td align="right">76.04</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">sp_003</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">sp_004</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>The first column <strong><code>"species"</code></strong> contains species names, while the next 6 columns contain the trait values for all species. Note that the species names are anonymized because the IUCN data <a href="https://www.iucnredlist.org/terms/terms-of-use#4.%20No%20Reposting%20or%20Redistribution" class="external-link">cannot be redistributed</a>.</p>
<p>Let’s look at a summary of the trait dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span>
<span><span class="co">#&gt;    species          adult_body_mass    gestation_length  litter_size   </span></span>
<span><span class="co">#&gt;  Length:149         Min.   :     2.3   Min.   : 19.50   Min.   :0.980  </span></span>
<span><span class="co">#&gt;  Class :character   1st Qu.:    11.2   1st Qu.: 26.61   1st Qu.:1.500  </span></span>
<span><span class="co">#&gt;  Mode  :character   Median :    35.9   Median : 41.99   Median :3.055  </span></span>
<span><span class="co">#&gt;                     Mean   : 18809.7   Mean   : 69.93   Mean   :3.369  </span></span>
<span><span class="co">#&gt;                     3rd Qu.:  2573.2   3rd Qu.: 76.70   3rd Qu.:4.970  </span></span>
<span><span class="co">#&gt;                     Max.   :675876.7   Max.   :265.99   Max.   :8.990  </span></span>
<span><span class="co">#&gt;                     NA's   :26         NA's   :61       NA's   :35     </span></span>
<span><span class="co">#&gt;  max_longevity   sexual_maturity_age  diet_breadth  </span></span>
<span><span class="co">#&gt;  Min.   : 12.0   Min.   :  25.37     Min.   :1.000  </span></span>
<span><span class="co">#&gt;  1st Qu.: 58.8   1st Qu.: 106.67     1st Qu.:1.000  </span></span>
<span><span class="co">#&gt;  Median :180.0   Median : 348.44     Median :1.000  </span></span>
<span><span class="co">#&gt;  Mean   :171.3   Mean   : 392.01     Mean   :2.458  </span></span>
<span><span class="co">#&gt;  3rd Qu.:252.0   3rd Qu.: 549.05     3rd Qu.:4.000  </span></span>
<span><span class="co">#&gt;  Max.   :600.0   Max.   :1542.25     Max.   :8.000  </span></span>
<span><span class="co">#&gt;  NA's   :68      NA's   :65          NA's   :66</span></span></code></pre></div>
<p>From there we can see that there are 149 included species and some missing trait values. For example, there we don’t have body mass for 26 species.</p>
<p>Note that to use your own species by traits <code>data.frame</code>, it should follow similar structure with the first column being named <strong><code>"species"</code></strong> and the other ones containing traits.</p>
</div>
<div class="section level3">
<h3 id="site-x-species">Site x Species<a class="anchor" aria-label="anchor" href="#site-x-species"></a>
</h3>
<p>This object contains species occurrences/abundance/coverage at sites<br>
of the study area. It is a <code>data.frame</code>. The first column, <strong><code>"site"</code></strong>, contains site names while the other columns contains the abundance of each species across sites.</p>
<p>Note that here we are talking about sites in an abstract way. These can be plots, assemblages, of whatever set of species you’re interested in.</p>
<p>The package <code>funbiogeo</code> comes with the example dataset <code>site_species</code>. Let’s look at it:</p>
<table class="table">
<caption>Format of site x species dataset</caption>
<thead><tr class="header">
<th align="center">site</th>
<th align="center">sp_001</th>
<th align="center">sp_002</th>
<th align="center">sp_003</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>The example dataset contains the occurrence of the 149 above-mentioned species across 1,505 sites (grid cells of 0.5° x 0.5° resolution).</p>
<p>Note that to use your own site by species <code>data.frame</code>, it should follow similar structure with the first column being named <strong><code>"sites"</code></strong> and the other ones containing presence information of species across sites.</p>
</div>
<div class="section level3">
<h3 id="site-x-locations">Site x Locations<a class="anchor" aria-label="anchor" href="#site-x-locations"></a>
</h3>
<p>This object contains the geographical location of the sites. It should be an <code>sf</code> object from the <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code> package</a>. The sites can have arbitrary shapes: points, regular polygons, irregular polygons, or even line transects! To make sure that your data is well plotted you should specify the Coordinate Reference System (CRS) of this object.</p>
<p>The package <code>funbiogeo</code> comes with the example dataset <code>site_locations</code> defining the location of the 1,505 sites (grid cells of 0.5° x 0.5° resolution). It contains the names of the site in its first column <strong><code>"site"</code></strong>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">site_locations</span></span>
<span><span class="co">#&gt; Simple feature collection with 1505 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -9.978179 ymin: 35.84736 xmax: 23.02182 ymax: 59.84736</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    site                           geom</span></span>
<span><span class="co">#&gt; 1     1 POLYGON ((5.521821 59.84736...</span></span>
<span><span class="co">#&gt; 2     2 POLYGON ((6.521821 59.84736...</span></span>
<span><span class="co">#&gt; 3     3 POLYGON ((7.021821 59.84736...</span></span>
<span><span class="co">#&gt; 4     4 POLYGON ((7.521821 59.84736...</span></span>
<span><span class="co">#&gt; 5     5 POLYGON ((8.021821 59.84736...</span></span>
<span><span class="co">#&gt; 6     6 POLYGON ((8.521821 59.84736...</span></span>
<span><span class="co">#&gt; 7     7 POLYGON ((9.021821 59.84736...</span></span>
<span><span class="co">#&gt; 8     8 POLYGON ((9.521821 59.84736...</span></span>
<span><span class="co">#&gt; 9     9 POLYGON ((10.02182 59.84736...</span></span>
<span><span class="co">#&gt; 10   10 POLYGON ((10.52182 59.84736...</span></span></code></pre></div>
<p>Note that to use your own site locations object, it should follow similar structure with the first column being named <strong><code>"sites"</code></strong>.</p>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-the-data-diagnostic-plots">Visualizing the data (diagnostic plots)<a class="anchor" aria-label="anchor" href="#visualizing-the-data-diagnostic-plots"></a>
</h2>
<p><code>funbiogeo</code> provides many functions to display the data to help the user select specific traits, species, and/or sites. We are going to detail some of them in this section. We call them <em>diagnostic plots</em> because they help us to have an overview of our dataset <strong>prior</strong> to the analyses.</p>
<div class="section level3">
<h3 id="trait-completeness-per-species">Trait completeness per species<a class="anchor" aria-label="anchor" href="#trait-completeness-per-species"></a>
</h3>
<p>A first way to visualize our <code>data.frame</code> is to look at the proportion of species with non-missing traits using the <code><a href="../reference/fb_plot_number_species_by_trait.html">fb_plot_number_species_by_trait()</a></code> function. It takes the species by trait <code>data.frame</code> as input.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_species_by_trait.html">fb_plot_number_species_by_trait</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="funbiogeo_files/figure-html/fig-plot-sp-by-trait-1.png" width="100%"></p>
<p>This plot shows us the number of species (along the x-axis) in function of the trait name (along the y-axis). The number of concerned species is shown at the bottom of the plot while the corresponding proportion of species (compared to all the species included in the trait dataset) is indicated as a secondary x-axis at the top. The proportion of species concerned is shown at the right of each point. For example, in our example dataset, 82.6% species have a non-NA adult body mass.</p>
<p>The function also include a way to provide a target proportion of species as the second argument. It will display the proportion as a dark red dashed line.</p>
<p>For example, if we want to visualize which traits cover more than 75% of the species:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_species_by_trait.html">fb_plot_number_species_by_trait</a></span><span class="op">(</span><span class="va">species_traits</span>, <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="funbiogeo_files/figure-html/fig-plot-sp-by-trait-prop-1.png" width="100%"></p>
<p>The top number shows the corresponding number of species.</p>
</div>
<div class="section level3">
<h3 id="number-of-traits-per-species">Number of Traits per Species<a class="anchor" aria-label="anchor" href="#number-of-traits-per-species"></a>
</h3>
<p>Another way to filter the data would be to select certain species that have at least a certain number of traits. This can be visualized using the <code><a href="../reference/fb_plot_number_traits_by_species.html">fb_plot_number_traits_by_species()</a></code> function. Similarly to the above-mentioned function, it takes the species x traits <code>data.frame</code> as the first argument:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_plot_number_traits_by_species.html">fb_plot_number_traits_by_species</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span></code></pre></div>
<p><img src="funbiogeo_files/figure-html/fig-plot-trait-by-sp-1.png" width="100%"></p>
<p>The plot shows the number (bottom axis) and the proportion (top axis) of species covered by a specific number of traits (0 to 6 in our example).</p>
</div>
</div>
<div class="section level2">
<h2 id="filtering-the-data">Filtering the data<a class="anchor" aria-label="anchor" href="#filtering-the-data"></a>
</h2>
<p>Now that we displayed the diagnostic plots, we can decide thresholds and filter our data for our following analyses.</p>
<div class="section level3">
<h3 id="filter-trait-by-species-coverage">Filter trait by species coverage<a class="anchor" aria-label="anchor" href="#filter-trait-by-species-coverage"></a>
</h3>
<p>We want to select the traits that cover at least 75% of the species. To do that we can use the <code><a href="../reference/fb_filter_traits_by_species_coverage.html">fb_filter_traits_by_species_coverage()</a></code> function. The function takes the species by traits <code>data.frame</code> and outputs the same dataset but with the traits filtered (so with less columns). The second argument <code>threshold_species_proportion</code> is the threshold proportion of species covered:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initial dimension of the input data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">species_traits</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 149   7</span></span>
<span></span>
<span><span class="co"># Filter traits </span></span>
<span><span class="va">red_sp_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fb_filter_traits_by_species_coverage.html">fb_filter_traits_by_species_coverage</a></span><span class="op">(</span></span>
<span>  <span class="va">species_traits</span>, threshold_species_proportion <span class="op">=</span>  <span class="fl">0.75</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">red_sp_traits</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 149   3</span></span>
<span></span>
<span><span class="co"># The reduced data set now has fewer trait columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">red_sp_traits</span><span class="op">)</span></span>
<span><span class="co">#&gt;   species adult_body_mass litter_size</span></span>
<span><span class="co">#&gt; 1  sp_001       461900.76        1.25</span></span>
<span><span class="co">#&gt; 2  sp_002           21.11        5.64</span></span>
<span><span class="co">#&gt; 3  sp_003              NA          NA</span></span>
<span><span class="co">#&gt; 4  sp_004              NA          NA</span></span>
<span><span class="co">#&gt; 5  sp_005           31.60        4.94</span></span>
<span><span class="co">#&gt; 6  sp_006           21.90        5.16</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filter-species-by-trait-coverage">Filter species by trait coverage<a class="anchor" aria-label="anchor" href="#filter-species-by-trait-coverage"></a>
</h3>
<p>Similarly you could filter species by their trait coverage. For example we would like to make sure that the species we filtered previously so that they show at least one of the two traits selected above. We can use the function <code><a href="../reference/fb_filter_species_by_trait_coverage.html">fb_filter_species_by_trait_coverage()</a></code> with the species x traits <code>data.frame</code> as the first argument and the second argument the proportion of traits covered by species.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter species with at least 50% of included (two traits)</span></span>
<span><span class="co"># at least one trait</span></span>
<span><span class="va">red_sp_traits_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fb_filter_species_by_trait_coverage.html">fb_filter_species_by_trait_coverage</a></span><span class="op">(</span></span>
<span>  <span class="va">red_sp_traits</span>, threshold_traits_proportion <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">red_sp_traits_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   species adult_body_mass litter_size</span></span>
<span><span class="co">#&gt; 1  sp_001       461900.76        1.25</span></span>
<span><span class="co">#&gt; 2  sp_002           21.11        5.64</span></span>
<span><span class="co">#&gt; 5  sp_005           31.60        4.94</span></span>
<span><span class="co">#&gt; 6  sp_006           21.90        5.16</span></span>
<span><span class="co">#&gt; 7  sp_007           18.26        5.72</span></span>
<span><span class="co">#&gt; 9  sp_009          903.98        2.50</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">red_sp_traits_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 127   3</span></span></code></pre></div>
<p>We thus have selected 2 traits that cover at least 75% of the species and 127 species which have known values for these two traits.</p>
</div>
<div class="section level3">
<h3 id="filter-sites-by-trait-coverage">Filter sites by trait coverage<a class="anchor" aria-label="anchor" href="#filter-sites-by-trait-coverage"></a>
</h3>
<p>Now that we have filtered our traits and species of interest we need to filter the sites. Similarly to above the function is <code><a href="../reference/fb_filter_sites_by_trait_coverage.html">fb_filter_sites_by_trait_coverage()</a></code> it takes as two first arguments the site x species <code>data.frame</code> and the species x traits <code>data.frame</code>. The third argument is <code>threshold_traits_proportion</code> that indicates the percent coverage of traits to filter each site. Note that this coverage is weighted by the occurrence, abundance, or cover depending on the content of the site x species <code>data.frame</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initial site x species data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_species</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1505  150</span></span>
<span></span>
<span><span class="co"># Filter sites with at least 90% species covered</span></span>
<span><span class="va">filt_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fb_filter_sites_by_trait_coverage.html">fb_filter_sites_by_trait_coverage</a></span><span class="op">(</span></span>
<span>  <span class="va">site_species</span>, <span class="va">red_sp_traits_2</span>, threshold_traits_proportion <span class="op">=</span> <span class="fl">0.9</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filtered sites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">filt_sites</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1268  150</span></span>
<span></span>
<span><span class="va">filt_sites</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt;   site sp_001 sp_002 sp_003</span></span>
<span><span class="co">#&gt; 1    1      1      0      0</span></span>
<span><span class="co">#&gt; 2    2      1      0      0</span></span>
<span><span class="co">#&gt; 3    3      1      0      0</span></span>
<span><span class="co">#&gt; 4    4      1      0      0</span></span></code></pre></div>
<p>Now we selected 1,268 sites out of 1,505.</p>
</div>
</div>
<div class="section level2">
<h2 id="computing-functional-diversity-metrics">Computing Functional Diversity metrics<a class="anchor" aria-label="anchor" href="#computing-functional-diversity-metrics"></a>
</h2>
<p>Now that <code>funbiogeo</code> helped us filter our data we can use them to proceed with our analyses. We can for example compute functional diversity indices. This where you should use your preferred packages to compute functional diversity indices like <a href="https://cran.r-project.org/package=mFD" class="external-link"><code>mFD</code></a>, <a href="https://cran.r-project.org/package=betapart" class="external-link"><code>betapart</code></a>, or <a href="https://cran.r-project.org/package=hypervolume" class="external-link"><code>hypervolume</code></a>.</p>
<p>For the sake of the example we included a single function in <code>funbiogeo</code> to compute Community-Weighted Mean <span class="citation">(CWM, Garnier et al. 2004)</span> named <code><a href="../reference/fb_cwm.html">fb_cwm()</a></code>. The CWM is the abundance-weighted average trait per site. We’ll be using it in the following section but feel free to use any other functional diversity package.</p>
<div class="section level3">
<h3 id="community-weighted-mean-cwm">Community-Weighted Mean (CWM)<a class="anchor" aria-label="anchor" href="#community-weighted-mean-cwm"></a>
</h3>
<p>To compute the CWM you can use the <code><a href="../reference/fb_cwm.html">fb_cwm()</a></code> function, it takes the site x species <code>data.frame</code> and species x traits <code>data.frame</code> as arguments.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cwm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fb_cwm.html">fb_cwm</a></span><span class="op">(</span><span class="va">filt_sites</span>, <span class="va">red_sp_traits_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Some species had NA trait values, removing them from CWM computation</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cwm</span><span class="op">)</span></span>
<span><span class="co">#&gt;   site           trait      cwm</span></span>
<span><span class="co">#&gt; 1    1 adult_body_mass 31974.15</span></span>
<span><span class="co">#&gt; 2    2 adult_body_mass 39911.51</span></span>
<span><span class="co">#&gt; 3    3 adult_body_mass 39912.54</span></span>
<span><span class="co">#&gt; 4    4 adult_body_mass 39912.54</span></span>
<span><span class="co">#&gt; 5    5 adult_body_mass 41389.44</span></span>
<span><span class="co">#&gt; 6    6 adult_body_mass 39912.37</span></span></code></pre></div>
<p>It outputs a <code>data.frame</code> with 3 columns: <code>site</code> the first one shows the site name as provided in the input site x species <code>data.frame</code>, <code>trait</code> which indicates the trait name on which the CWM is computed, and <code>cwm</code> which shows the value of the CWM.</p>
</div>
</div>
<div class="section level2">
<h2 id="putting-functional-diversity-on-the-map">Putting Functional Diversity on the map<a class="anchor" aria-label="anchor" href="#putting-functional-diversity-on-the-map"></a>
</h2>
<div class="section level3">
<h3 id="map-of-environment">Map of environment<a class="anchor" aria-label="anchor" href="#map-of-environment"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Read raster ----</span></span>
<span><span class="va">tavg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"extdata"</span>, <span class="st">"annual_mean_temp.tif"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tavg</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Map of raster ----</span></span>
<span><span class="fu"><a href="../reference/fb_map_raster.html">fb_map_raster</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span></span></code></pre></div>
<p><img src="funbiogeo_files/figure-html/map-tavg-1.png" width="100%"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fb_map_raster.html">fb_map_raster</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span><span class="st">"Temperature"</span>, palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Mean annual temperature in Pennsylvania"</span><span class="op">)</span></span></code></pre></div>
<p><img src="funbiogeo_files/figure-html/map-tavg-custom-1.png" width="100%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://patchwork.data-imaginist.com" class="external-link">"patchwork"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Read raster ----</span></span>
<span><span class="va">tavg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"annual_mean_temp.tif"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span><span class="op">)</span></span>
<span><span class="va">tavg</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">tavg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"annual_tot_prec.tif"</span>, package <span class="op">=</span> <span class="st">"funbiogeo"</span><span class="op">)</span></span>
<span><span class="va">prec</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Individual Maps ----</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fb_map_raster.html">fb_map_raster</a></span><span class="op">(</span><span class="va">tavg</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span><span class="st">"Temperature"</span>, palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fb_map_raster.html">fb_map_raster</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span><span class="st">"Precipitation"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Arrangement ----</span></span>
<span><span class="va">figure</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">/</span> <span class="va">y</span></span>
<span></span>
<span><span class="va">figure</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Pennsylvania"</span>, </span>
<span>                  theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"mono"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="funbiogeo_files/figure-html/composition-map-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="map-of-indices">Map of indices<a class="anchor" aria-label="anchor" href="#map-of-indices"></a>
</h3>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Garnier_Plant_2004" class="csl-entry">
Garnier, Eric, Jacques Cortez, Georges Billès, Marie-Laure Navas, Catherine Roumet, Max Debussche, Gérard Laurent, et al. 2004. <span>“Plant <span>Functional Markers Capture Ecosystem Properties During Secondary Succession</span>.”</span> <em>Ecology</em> 85 (9): 2630–37. <a href="https://doi.org/10.1890/03-0799" class="external-link">https://doi.org/10.1890/03-0799</a>.
</div>
<div id="ref-Jones_PanTHERIA_2009" class="csl-entry">
Jones, Kate E., Jon Bielby, Marcel Cardillo, Susanne A. Fritz, Justin O’Dell, C. David L. Orme, Kamran Safi, et al. 2009. <span>“<span>PanTHERIA</span>: A Species-Level Database of Life History, Ecology, and Geography of Extant and Recently Extinct Mammals.”</span> <em>Ecology</em> 90 (9): 2648–48. <a href="https://doi.org/10.1890/08-1494.1" class="external-link">https://doi.org/10.1890/08-1494.1</a>.
</div>
<div id="ref-Violle_emergence_2014" class="csl-entry">
Violle, Cyrille, Peter B. Reich, Stephen W. Pacala, Brian J. Enquist, and Jens Kattge. 2014. <span>“The Emergence and Promise of Functional Biogeography.”</span> <em>Proceedings of the National Academy of Sciences</em> 111 (38): 13690–96. <a href="https://doi.org/10.1073/pnas.1415442111" class="external-link">https://doi.org/10.1073/pnas.1415442111</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicolas Casajus, Matthias Grenié.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
